<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcode Search Demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <script src="https://unpkg.com/@zxing/browser"></script>
    <script src="https://unpkg.com/@zxing/browser@latest"></script>
    <script type="module">
        import { BrowserBarcodeReader } from 'https://cdn.jsdelivr.net/npm/@zxing/browser@latest/+esm';
    
        window.ZXing = { BrowserBarcodeReader };
    </script>
    
    <style>
        #barcodeScanner { width: 100%; max-width: 400px; display: none; }
    </style>
</head>
<body>
    <h2>Barcode Search Demo</h2>
    
    <input type="text" id="searchBox" placeholder="Search or scan..." autofocus>
    <button onclick="startScanner()">Scan Barcode</button>
    <video id="barcodeScanner"></video>
    <button onclick="startZXingScanner()">Scan Barcode with ZXing</button>
    <video id="barcodeScanner" style="width: 100%; max-width: 400px; display: none;"></video>

    <ul id="itemList"></ul>
    
    <script>
        let items = [
            { name: "Item A", code: "123456" },
            { name: "Item B", code: "789012" },
            { name: "Item C", code: "345678" }
        ];
        
        document.getElementById("searchBox").addEventListener("input", filterItems);
        document.getElementById("searchBox").addEventListener("keypress", function(event) {
            if (event.key === "Enter") filterItems();
        });

        function filterItems() {
            let query = document.getElementById("searchBox").value.toLowerCase();
            let filtered = items.filter(item => item.name.toLowerCase().includes(query) || item.code.includes(query));
            
            let list = document.getElementById("itemList");
            list.innerHTML = "";
            filtered.forEach(item => {
                let li = document.createElement("li");
                li.textContent = `${item.name} (${item.code})`;
                list.appendChild(li);
            });
        }

        function startScanner() {
            let scannerElement = document.getElementById("barcodeScanner");
            scannerElement.style.display = "block";

            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: scannerElement,
                    constraints: {
                        width: { min: 640, ideal: 1280, max: 1920 },
                        height: { min: 480, ideal: 720, max: 1080 },
                        facingMode: "environment" // Forces back camera
                    }
                },
                locator: { patchSize: "medium", halfSample: true },
                decoder: { readers: ["ean_reader", "code_128_reader"] }
            }, function(err) {
                if (!err) {
                    Quagga.start();
                } else {
                    console.error("Quagga initialization failed: ", err);
                }
            });

            Quagga.onDetected(function(result) {
                let barcode = result.codeResult.code;
                document.getElementById("searchBox").value = barcode;
                Quagga.stop();
                scannerElement.style.display = "none";
                filterItems();
            });
        }

        function startZXingScanner() {
            let scannerElement = document.getElementById("barcodeScanner");
            scannerElement.style.display = "block";

            // Check if ZXing is loaded
            if (typeof ZXing === "undefined") {
                console.error("ZXing is not loaded. Check script import.");
                return;
            }

            const codeReader = new ZXing.BrowserBarcodeReader();

            // Request camera access
            navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
                .then(() => {
                    codeReader.decodeFromVideoDevice(undefined, scannerElement, (result, err) => {
                        if (result) {
                            document.getElementById("searchBox").value = result.text;
                            scannerElement.style.display = "none";
                            codeReader.reset();
                            filterItems();
                        }
                    });
                })
                .catch(err => {
                    console.error("Camera access denied: ", err);
                    scannerElement.style.display = "none";
                });
        }


    </script>
</body>
</html>
